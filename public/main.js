function getTime(){return[now.getMilliseconds()/999,now.getSeconds()/60,now.getMinutes()/60]}function setScales(){d3.select("svg").attr("height",svgHeight).attr("width",svgWidth),radiusScale.range([0,.35*svgHeight]),hourScale.rangeBands([-1,svgWidth]),horizonScale.range([svgHeight,0,svgHeight]),legendScale.range([legendMargin,svgWidth-legendMargin])}function setLegend(){legend=svg.selectAll("text").data(labels).attr("x",function(e,n){return legendScale(n)}).attr("y",svgHeight-legendMargin).attr("dy","0.75em").attr("text-anchor",function(e){return e.textAnchor}).style("fill",blue).text(function(e){return e.value})}function setSvgDimensions(){svgWidth=window.innerWidth,svgHeight=window.innerHeight,setScales(),setLegend(),tick(getTime(now))}function tick(e){hands=svg.selectAll("circle").data(e).transition().duration(frameRate).attr("cx",function(){return hourScale(now.getHours())}).attr("cy",function(){return horizonScale(now.getHours())}).attr("r",function(e){return radiusScale(e)}).style("fill",function(e,n){return colorScale(n)}).style("opacity",function(e){return console.log(e,opacityScale(e)),opacityScale(e)})}var now=new Date,time=getTime(now),svgWidth=900,svgHeight=600,clock=".clock",frameRate=500,now=new Date,blue="hsl(221, 85%, 22%)",peach="hsl(31, 100%, 50%)",orange="hsl(41, 100%, 50%)",yellow="hsl(51, 100%, 50%)",colorScale=d3.scale.ordinal().domain(d3.range(3)).range([peach,orange,yellow]),opacityScale=d3.scale.linear().domain(d3.range(2)).range([1,.7]),maximumTime=[-1,1],radiusScale=d3.scale.linear().domain(maximumTime),hourScale=d3.scale.ordinal().domain(d3.range(24)),horizonScale=d3.scale.linear().domain([0,12,23]),labels=[{value:"AM",textAnchor:"start"},{value:"PM",textAnchor:"end"}],legendMargin=25,legendScale=d3.scale.ordinal().domain(d3.range(labels.length)),svg=d3.select(clock).append("svg").append("g"),hands=svg.selectAll("g").data(time).enter().append("g");hands.append("circle").style("fill",function(e,n){return colorScale(n)});var legend=svg.selectAll("text").data(labels).enter().append("text");setSvgDimensions(),window.onresize=setSvgDimensions,setInterval(function(){now=new Date;var e=getTime(now);tick(e)},frameRate);